name: Build Matrix

on:
  workflow_call:
    outputs:
      build-matrix:
        description: "The build matrix JSON"
        value: ${{ jobs.define-matrix.outputs.build-matrix }}

jobs:
  define-matrix:
    runs-on: ubuntu-latest
    outputs:
      build-matrix: ${{ steps.set-matrix.outputs.matrix }}
    steps:
      - name: Set Matrix JSON
        id: set-matrix
        run: |
          JSON_STRING=$(cat <<EOF
          {
            "include": [
              { "runner": "ubuntu-latest", "arch": "x64", name: "linux" },
              { "runner": "macos-latest", "arch": "x64", name: "darwin" },
              { "runner": "macos-latest", "arch": "arm64", name: "darwin" },
              { "runner": "windows-latest", "arch": "x64", name: "windows" },
            ]
          }
          EOF
          )
          
          echo "matrix<<EOF" >> $GITHUB_OUTPUT
          echo "$JSON_STRING" >> $GITHUB_OUTPUT
          echo "EOF" >> $GITHUB_OUTPUT
